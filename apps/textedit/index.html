<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.12.2/react.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.12.2/JSXTransformer.js" type="text/javascript"></script>

<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<link rel="stylesheet" href="//cdn.quilljs.com/0.19.8/quill.snow.css" />
<script src="//cdn.quilljs.com/0.19.8/quill.min.js"></script>

<script type="text/jsx">

  /** @jsx React.DOM */
  'use strict';

  var textEditor;

  function receiveTextData() {
    if(AS._state.htmlValue) {
      textEditor.setHTML(AS._state.htmlValue);
    } else if(AS._state.textValue) {
      textEditor.setText(AS._state.textValue);
    }
  }

  // Document editor class
  var Editor = React.createClass({

    /**
    * When component mounted, bind application state interefece events
    */
    componentDidMount: function() {
      var editor = this.refs.editor.getDOMNode();

      textEditor = new Quill(editor, {
        formats: ['bold', 'italic', 'color', 'size', 'underline'],
        theme: 'snow'
      });

      textEditor.addModule('toolbar', {
        container: '#toolbar'
      });

      textEditor.on("text-change", function(delta, source) {

        if(source === "user") {
          AS._state.textValue = textEditor.getText();
          AS._state.htmlValue = textEditor.getHTML();
        }
      });

      AS.on('syncedState', receiveTextData);
      AS.on('load', receiveTextData);
    },

    /**
    * Render the editor
    */
    render: function() {
      return (
        <div className="editor-container">
          <div id="toolbar" className="toolbar">

            <span className="ql-format-group">
              <select title="Size" className="ql-size ql-picker">
                <option value="small">Small</option>
                <option value="normal" defaultValue>Normal</option>
                <option value="large">Large</option>
                <option value="huge">Huge</option>
              </select>
            </span>

            <span className="ql-format-group">
              <span className="ql-format-button ql-bold"></span>
              <span className="ql-format-separator"></span>
              <span className="ql-format-button ql-italic"></span>
              <span className="ql-format-separator"></span>
              <span className="ql-format-button ql-underline"></span>
            </span>
          </div>

          <div className="editor" ref="editor">
          </div>
        </div>
      );
    }
  });

  // Renender the editor
  React.render(<Editor />, document.body);

</script>
